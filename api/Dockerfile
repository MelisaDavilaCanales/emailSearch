FROM golang:1.23.1-alpine

RUN mkdir app

WORKDIR /app

COPY go.mod go.sum ./

ARG API_PORT \
    APP_MODE \
    DB_USER \
    DB_PASSWORD \ 
    ZINC_SEARCH_API_URL \
    ZINC_SEARCH_AGGREGATION_API_URL 

ENV API_PORT=${API_PORT} \
    APP_MODE=${APP_MODE} \
    DB_USER=${DB_USER} \
    DB_PASSWORD=${DB_PASSWORD} \
    ZINC_SEARCH_API_URL=${ZINC_SEARCH_API_URL} \
    ZINC_SEARCH_AGGREGATION_API_URL=${ZINC_SEARCH_AGGREGATION_API_URL} 

RUN go mod download

COPY . .

RUN go build -o api .

CMD ["./api"]